<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<%= include_gon %>
<html lang="en">
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>
    <meta charset="utf-8"/>
    <title>Search</title>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">/</link>
    <link href="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></link>
  </head>
  <body>
    <div class="navbar-fixed-top container">
      <div class="navbar">
        <div class="navbar-inner">
          <form>
            <div class="row">
              <a class="btn btn-info btn-sm col-xs-1" href="#">
                <span class="glyphicon glyphicon-menu-hamburger"></span>
              </a>
              <div class="form-group col-xs-10">
                <input class="form-control" name="search" placeholder="Enter the bird name">/</input>
              </div>
              <button class="btn btn-default col-xs-1" type="submit">Search</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div id="map"></div>
    <% if flash[:alert] != "" %>
      <h3>
        <%= flash[:alert]  %>
      </h3>
    <% end %>
    <script>
      
      $('#search_result').reset();
      function initMap() {
        var birds = [];
        for (var i = 0; i < gon.pins.length; i++) {
          bird = gon.pins[i];
          birds.push({lat: bird.locationX, lng: bird.locationY});
        }
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 4,
          center: birds[0]
        });
        for (var i = 0; i < birds.length; i++) {
          pin = gon.pins[i];
          var pin1 = birds[i];
          bird = null;
          for (var j = 0; j < gon.birds.length; j++) {
            if (gon.birds[j].id == pin.bird_id) {
              bird = gon.birds[j];
            }
          }
          contentString = '<div id="content">'+
             '<div id="siteNotice">'+
             '</div>' + '<div id="bodyContent">'+
             '<p><b>'
              + bird.name
             + '</b></p><p>'
            + "Last Seen: " + bird.last_seen + '</p><p>'
            + "Total Seen: " + bird.frequency
             + '</p>'+
             '<p>Link: <a href=' + bird.wiki_link + '>'
             + bird.wiki_link + '</a>'+
             '</p>'+
            '</div>'+
            '</div>';
          var infowindow = new google.maps.InfoWindow({
            content: 'bullshit'
          });
          var marker = new google.maps.Marker({
            position: pin1,
            map: map
          });
          
          marker.contentString = contentString;
          marker.addListener('click', function() {
            infowindow.setContent(this.contentString);
            infowindow.open(map, this);
          });
        }
      }

    </script>
    <script defer="defer" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAZAXAHxRrKlhRSya8IoRc2goYTuUi3ISE&callback=initMap">
      <cdata>
        


      </cdata>
    </script>
  </body>
</html>
<ul class="nav nav-tabs">
  <li class="active" role="presentation">
    <a href="#">Home</a>
  </li>
  <li role="presentation">
    <a href="#">Profile</a>
  </li>
  <li role="presentation">
    <a href="#">Messages</a>
  </li>
</ul>
<input id="search_result" type="hidden" value="<%= @birds %>"></input>
